version: '3.8'

services:
  # User Service API
  user-api:
    image: mango-user-service-api:latest
    container_name: mango-user-api
    ports:
      - "5001:5001"
      - "5000:5000"
    environment:
      ASPNETCORE_ENVIRONMENT: Development
      ASPNETCORE_URLS: http://+:5001
      ConnectionStrings__DefaultConnection: "Host=host.docker.internal;Port=5432;Database=mango_user_service;Username=postgres;Password=Adib@054008"
      AWS__EventBusName: "mango.events"
      AWS__Region: "us-east-1"
      AWS_SHARED_CREDENTIALS_FILE: /root/.aws/credentials
      AWS_CONFIG_FILE: /root/.aws/config
    volumes:
      - ${USERPROFILE}/.aws:/root/.aws:ro
    networks:
      - mango-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:5001/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

networks:
  mango-network:
    driver: bridge


